{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manage Users | A.C.E. Scheduling System</title>
    <link rel="icon" type="image/png" href="{% static 'scheduler/images/Automated_Class_Scheduling_Logo-removebg-preview.png' %}">
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="{% static 'scheduler/css/admin/darkmode.css' %}?v=2025">
    <link rel="stylesheet" href="{% static 'scheduler/css/admin/manage_subjects.css' %}?v=2025" />
    <link rel="stylesheet" href="{% static 'scheduler/css/admin/dashboard.css' %}?v=2025" />
    <link rel="stylesheet" href="{% static 'scheduler/css/admin/manage_users.css' %}?v=2025" />
    <link rel="stylesheet" href="{% static 'scheduler/css/admin/dark_modal.css' %}?v=2025" />
    <link rel="stylesheet" href="{% static 'scheduler/css/admin/view_modal.css' %}?v=2025" />
    <script src="{% static 'scheduler/js/global_darkmode.js' %}?v=2025" defer></script>
</head>

<style>
    /* ===============================
   DARK THEME DELETE MODAL STYLES
=============================== */

/* Modal Overlay */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.75);
  backdrop-filter: blur(4px);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}

.modal.show {
  display: flex !important;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Modal Content - Dark Theme */
.delete-modal-content-dark {
  background: #1e293b;
  border-radius: 12px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  animation: slideDown 0.3s ease-out;
  border: 1px solid #334155;
}

@keyframes slideDown {
  from {
    transform: translateY(-50px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

/* Modal Header - Dark Theme */
.delete-modal-header-dark {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 24px;
  background: #2d3748;
  border-radius: 12px 12px 0 0;
  border-bottom: 1px solid #374151;
}

.delete-modal-header-dark h3 {
  margin: 0;
  color: #f1f5f9;
  font-size: 18px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 10px;
}

.delete-modal-header-dark h3 i {
  color: #ef4444;
  font-size: 20px;
}

.delete-modal-header-dark .close {
  color: #cbd5e1;
  font-size: 24px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  line-height: 1;
  padding: 0;
  background: transparent;
  border: none;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 6px;
}

.delete-modal-header-dark .close:hover {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
}

/* Modal Body - Dark Theme */
.delete-modal-body-dark {
  padding: 24px;
}

.delete-warning-text-dark {
  font-size: 15px;
  color: #e2e8f0;
  margin-bottom: 16px;
  font-weight: 400;
  line-height: 1.6;
}

.delete-warning-text-dark strong {
  color: #ef4444;
  font-weight: 600;
}

/* Warning Box - Dark Theme */
.delete-warning-box-dark {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 14px 16px;
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.3);
  border-left: 3px solid #ef4444;
  border-radius: 8px;
  margin-bottom: 24px;
}

.delete-warning-box-dark i {
  color: #ef4444;
  font-size: 16px;
  margin-top: 2px;
  flex-shrink: 0;
}

.delete-warning-box-dark span {
  color: #cbd5e1;
  font-size: 13px;
  line-height: 1.5;
}

/* Modal Actions - Dark Theme */
.modal-actions-dark {
  display: flex;
  gap: 12px;
  margin-top: 0;
}

/* Buttons - Dark Theme */
.btn-dark {
  flex: 1;
  padding: 12px 20px;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-family: "Poppins", sans-serif;
  text-decoration: none;
  white-space: nowrap;
}

.btn-cancel-dark {
  background: #374151;
  color: #e2e8f0;
  border: 1px solid #4b5563;
}

.btn-cancel-dark:hover {
  background: #4b5563;
  border-color: #6b7280;
  transform: translateY(-1px);
}

.btn-delete-dark {
  background: linear-gradient(135deg, #e74a3b 0%, #c82333 100%);
  color: var(--white);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.btn-delete-dark:hover {
  background: #2563eb;
  transform: translateY(-1px);
  box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
}

/* Responsive Design */
@media (max-width: 767px) {
  .delete-modal-content-dark {
    width: 95%;
    margin: 20px;
  }

  .delete-modal-header-dark {
    padding: 16px 20px;
  }

  .delete-modal-header-dark h3 {
    font-size: 16px;
  }

  .delete-modal-body-dark {
    padding: 20px;
  }

  .modal-actions-dark {
    flex-direction: column;
  }

  .btn-dark {
    width: 100%;
  }

  .delete-warning-text-dark {
    font-size: 14px;
  }

  .delete-warning-box-dark {
    padding: 12px 14px;
  }

  .delete-warning-box-dark span {
    font-size: 12px;
  }
}

@media (max-width: 480px) {
  .delete-modal-content-dark {
    width: 90%;
  }

  .btn-dark {
    padding: 10px 16px;
    font-size: 13px;
  }
}

/* Dark Mode Compatibility */
body.dark-mode .delete-modal-content-dark {
  background: #1e293b;
  border-color: #334155;
}

body.dark-mode .delete-modal-header-dark {
  background: #2d3748;
  border-bottom-color: #374151;
}

body.dark-mode .delete-warning-text-dark {
  color: #e2e8f0;
}

body.dark-mode .delete-warning-box-dark {
  background: rgba(239, 68, 68, 0.1);
  border-color: rgba(239, 68, 68, 0.3);
}

body.dark-mode .delete-warning-box-dark span {
  color: #cbd5e1;
}

body.dark-mode .btn-cancel-dark {
  background: #374151;
  color: #e2e8f0;
  border-color: #4b5563;
}

body.dark-mode .btn-cancel-dark:hover {
  background: #4b5563;
}

/* ===============================
   VIEW USER MODAL - DARK MODE SUPPORT
=============================== */

/* View Modal Content */
body.dark-mode .modal-content {
  background: #1e293b;
  border: 1px solid #334155;
}

body.dark-mode .modal-header {
  background: #2d3748;
  border-bottom: 1px solid #374151;
}

body.dark-mode .modal-header h3 {
  color: #f1f5f9;
}

body.dark-mode .modal-header .close {
  color: #cbd5e1;
}

body.dark-mode .modal-header .close:hover {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
}

body.dark-mode .modal-body {
  background: #1e293b;
  color: #e2e8f0;
}

body.dark-mode .modal-footer {
  background: #1a1f2e;
  border-top: 1px solid #374151;
}

/* Profile Section */
body.dark-mode .profile-section {
  background: #1e293b;
}

body.dark-mode .profile-header {
  background: #2d3748;
  border-bottom: 1px solid #374151;
}

body.dark-mode .profile-header h2,
body.dark-mode .profile-info h2 {
  color: #f1f5f9 !important;
}

body.dark-mode .profile-header p,
body.dark-mode .profile-info p {
  color: #94a3b8 !important;
}

body.dark-mode .profile-avatar {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color: #ffffff;
}

body.dark-mode .profile-avatar i {
  color: #ffffff;
}

/* Profile Details */
body.dark-mode .profile-details {
  background: #1e293b;
}

body.dark-mode .detail-row {
  border-bottom: 1px solid #334155;
}

body.dark-mode .detail-label {
  color: #0f1114;
}

body.dark-mode .detail-label i {
  color: #3b82f6;
}

body.dark-mode .detail-value {
  color: #0f1114;
  font-weight: 500;
}

/* Badges in Dark Mode */
body.dark-mode .badge {
  background: (--text-dark);
  color: #e2e8f0;
}

body.dark-mode .badge-active {
  background: rgba(34, 197, 94, 0.2);
  color: #4ade80;
  border: 1px solid rgba(34, 197, 94, 0.3);
}

body.dark-mode .badge-inactive {
  background: rgba(239, 68, 68, 0.2);
  color: #f87171;
  border: 1px solid rgba(239, 68, 68, 0.3);
}

body.dark-mode .badge-pending {
  background: rgba(251, 191, 36, 0.2);
  color: #fbbf24;
  border: 1px solid rgba(251, 191, 36, 0.3);
}

body.dark-mode .badge-instructor,
body.dark-mode .badge-admin {
  background: rgba(59, 130, 246, 0.2);
  color: #60a5fa;
  border: 1px solid rgba(59, 130, 246, 0.3);
}

/* Buttons in Dark Mode */
body.dark-mode .btn-cancel {
  background: #374151;
  color: #e2e8f0;
  border: 1px solid #4b5563;
}

body.dark-mode .btn-cancel:hover {
  background: #4b5563;
  border-color: #6b7280;
}

/* Animation for modal close */
@keyframes fadeOut {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(-20px);
  }
}

/* ===============================
   VIEW USER MODAL STYLES
=============================== */

/* Profile Section Container */
.profile-section {
  background: var(--white);
  border-radius: 8px;
  overflow: hidden;
}

/* Profile Header */
.profile-header {
  display: flex;
  align-items: center;
  gap: 20px;
  padding: 24px;
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  border-bottom: 1px solid var(--border);
}

.profile-avatar {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 48px;
  color: var(--white);
  flex-shrink: 0;
  border: 3px solid rgba(255, 255, 255, 0.3);
}

.profile-avatar i {
  color: var(--white);
}

.profile-info {
  flex: 1;
}

.profile-info h2 {
  margin: 0 0 8px 0;
  color: var(--white);
  font-size: 24px;
  font-weight: 600;
}

.profile-info p {
  margin: 0 0 12px 0;
  color: rgba(255, 255, 255, 0.9);
  font-size: 14px;
}

/* Profile Details */
.profile-details {
  padding: 0;
}

.detail-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 24px;
  border-bottom: 1px solid var(--border);
}

.detail-row:last-child {
  border-bottom: none;
}

.detail-label {
  font-weight: 500;
  color: var(--text-dark);
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.detail-label i {
  color: var(--text-dark);
  width: 18px;
  text-align: center;
}

.detail-value {
  color: var(--text-dark);
  font-size: 14px;
  font-weight: 500;
  text-align: right;
}

/* Modal Footer */
.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  padding: 20px 24px;
  background: #f9f9f9;
  border-top: 1px solid var(--border);
  border-radius: 0 0 12px 12px;
}

.modal-footer .btn-cancel {
  padding: 10px 20px;
  background: #6c757d;
  color: var(--white);
  border: none;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-family: "Poppins", sans-serif;
}

.modal-footer .btn-cancel:hover {
  background: #5a6268;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
}

/* Badge Styles */
.badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.badge-active {
  background: rgba(28, 200, 138, 0.1);
  color: #1cc88a;
  border: 1px solid rgba(28, 200, 138, 0.3);
}

.badge-inactive {
  background: rgba(231, 74, 59, 0.1);
  color: #e74a3b;
  border: 1px solid rgba(231, 74, 59, 0.3);
}

.badge-pending {
  background: rgba(246, 194, 62, 0.1);
  color: #f6c23e;
  border: 1px solid rgba(246, 194, 62, 0.3);
}

.badge-instructor,
.badge-admin,
.badge-student {
  background: rgba(78, 115, 223, 0.1);
  color: #4e73df;
  border: 1px solid rgba(78, 115, 223, 0.3);
}

/* Responsive Design */
@media (max-width: 767px) {
  .profile-header {
    flex-direction: column;
    text-align: center;
    padding: 20px;
  }

  .profile-avatar {
    width: 60px;
    height: 60px;
    font-size: 36px;
  }

  .profile-info h2 {
    font-size: 20px;
  }

  .profile-info p {
    font-size: 13px;
  }

  .detail-row {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
    padding: 12px 20px;
  }

  .detail-value {
    text-align: left;
    font-weight: 600;
  }

  .modal-footer {
    padding: 16px 20px;
  }

  .modal-footer .btn-cancel {
    width: 100%;
    justify-content: center;
  }
}

@media (max-width: 480px) {
  .profile-header {
    padding: 16px;
  }

  .profile-avatar {
    width: 50px;
    height: 50px;
    font-size: 30px;
  }

  .profile-info h2 {
    font-size: 18px;
  }

  .detail-row {
    padding: 10px 16px;
  }

  .detail-label,
  .detail-value {
    font-size: 13px;
  }
}


</style>

<body>
    <!-- Hamburger Menu Button -->
    <button class="hamburger-btn" id="hamburgerBtn" aria-label="Toggle Navigation">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Sidebar Overlay (for mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div>
            <div class="sidebar-header">
                <img src="{% static 'scheduler/images/Automated_Class_Scheduling_Logo-removebg-preview.png' %}" alt="Logo">
                <div class="logo-text">A.C.E <span>Sched</span></div>
            </div>
            <nav class="sidebar-nav">
                <a href="{% url 'admin_dashboard' %}"><i class="fas fa-th-large"></i><span>Dashboard</span></a>
                <a href="{% url 'manage_users' %}" class="active"><i class="fas fa-users"></i><span> Users</span></a>
                <a href="{% url 'manage_curriculum' %}"><i class="fas fa-book"></i><span> Subjects</span></a>
                <a href="{% url 'manage_sections' %}"><i class="fas fa-layer-group"></i><span> Sections</span></a>
                <a href="{% url 'manage_rooms' %}"><i class="fas fa-door-open"></i><span> Rooms</span></a>
                <a href="{% url 'manage_subjects' %}"><i class="fas fa-book-open"></i><span> Class Schedules</span></a>
                <a href="{% url 'manage_instructors' %}"><i class="fas fa-chalkboard-teacher"></i><span>Instructors</span></a>
                <a href="{% url 'manage_announcements' %}"><i class="fas fa-bullhorn"></i><span>Announcements</span></a>
            </nav>
        </div>
        <a href="#" class="logout-btn" onclick="openLogoutModal(); return false;"><i class="fas fa-sign-out-alt"></i><span> Logout</span></a>
    </aside>

    <!-- Main Content -->
    <div class="main-content">
        <div class="navbar">
            <div class="navbar-brand">Manage Users</div>
        </div>

        <div class="container-fluid">
            {% if messages %}
            <div class="toast-container">
                {% for message in messages %}
                {% if message.tags == 'success' %}
                <div class="toast toast-success auto-hide">{{ message }}</div>
                {% elif message.tags == 'error' %}
                <div class="toast toast-error auto-hide">{{ message }}</div>
                {% elif message.tags == 'warning' %}
                <div class="toast toast-warning auto-hide">{{ message }}</div>
                {% else %}
                <div class="toast toast-info auto-hide">{{ message }}</div>
                {% endif %}
                {% endfor %}
            </div>
            {% endif %}

            <!-- Search & Filters -->
            <div class="top-controls">
                <div class="search-wrapper">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" placeholder="Search by name, email, or role...">
                </div>

                <div class="filter-btns">
                    <button class="filter-btn active" data-role="all">All</button>
                    <button class="filter-btn" data-role="INSTRUCTOR">Instructors</button>
                    <button class="filter-btn" data-role="ADMIN">Admins</button>
                </div>
            </div>

            <!-- Bulk Actions Form -->
            <form method="POST">
                {% csrf_token %}
                <div class="bulk-actions">
                    <label>
                        <input type="checkbox" id="selectAll" class="rowCheckbox">
                        <span style="font-weight: 500; color: var(--text-dark);">Select All</span>
                    </label>
                    <select name="action" id="bulkAction">
                        <option value="">-- Bulk Actions --</option>
                        <option value="activate">Activate</option>
                        <option value="deactivate">Deactivate</option>
                        <option value="approve">Approve</option>
                        <option value="delete">Delete</option>
                    </select>
                    <button type="submit" class="bulk-btn" id="applyBulk">Apply</button>
                </div>

                <!-- Users Table -->
                <div class="table-wrapper">
                    <table class="user-table">
                        <thead>
                            <tr>
                                <th></th>
                                <th>#</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            {% for user in users %}
                            <tr data-role="{{ user.role }}">
                                <td><input type="checkbox" class="rowCheckbox userCheckbox" name="user_ids" value="{{ user.id }}"></td>
                                <td>{{ forloop.counter }}</td>
                                <td>{{ user.first_name }} {{ user.last_name }}</td>
                                <td>{{ user.email }}</td>
                                <td>{{ user.role|title }}</td>
                                <td>
                                    {% if user.is_active %}<span class="badge badge-active">Active</span>{% else %}<span class="badge badge-inactive">Inactive</span>{% endif %}
                                    {% if user.role == "STUDENT" and not user.is_approved %}<span class="badge badge-pending">Pending</span>{% endif %}
                                </td>
                                <td>
                                    <button type="button" class="action-btn view" onclick="openViewModal('{{ user.id }}')">
                                        <i class="fas fa-eye"></i> <span>View</span>
                                    </button>
                                    {% if user.role == "STUDENT" and not user.is_approved %}
                                    <a href="{% url 'approve_user' user.id %}" class="action-btn approve">
                                        <i class="fas fa-check-circle"></i> <span>Approve</span>
                                    </a>
                                    {% endif %}
                                    {% if user.is_active %}
                                    <a href="{% url 'deactivate_user' user.id %}" class="action-btn deactivate">
                                        <i class="fas fa-user-slash"></i> <span>Deactivate</span>
                                    </a>
                                    {% else %}
                                    <a href="{% url 'activate_user' user.id %}" class="action-btn activate">
                                        <i class="fas fa-user-check"></i> <span>Activate</span>
                                    </a>
                                    {% endif %}
                                    <button type="button" class="action-btn delete" onclick="openDeleteModal('{{ user.id }}')">
                                        <i class="fas fa-trash"></i> <span>Delete</span>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </form>

            <div class="pagination mt-3">
                {% if users.has_previous %}
                <a href="?page={{ users.previous_page_number }}{% if request.GET.role %}&role={{ request.GET.role }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" class="page-btn">&laquo; Prev</a>
                {% else %}
                <span class="page-btn disabled">&laquo; Prev</span>
                {% endif %}

                {% for num in users.paginator.page_range %}
                {% if users.number == num %}
                <span class="page-btn active">{{ num }}</span>
                {% else %}
                <a href="?page={{ num }}{% if request.GET.role %}&role={{ request.GET.role }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" class="page-btn">{{ num }}</a>
                {% endif %}
                {% endfor %}

                {% if users.has_next %}
                <a href="?page={{ users.next_page_number }}{% if request.GET.role %}&role={{ request.GET.role }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" class="page-btn">Next &raquo;</a>
                {% else %}
                <span class="page-btn disabled">Next &raquo;</span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- View User Modal -->
    <div id="viewUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-circle"></i> User Profile</h3>
                <span class="close" onclick="closeViewModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="profile-section">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="profile-info">
                            <h2 id="view_full_name"></h2>
                            <p id="view_email"></p>
                            <div style="display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap;">
                                <span id="view_role_badge" class="badge"></span>
                                <span id="view_status_badge" class="badge"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-details">
                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-user"></i> First Name:</span>
                            <span id="view_first_name" class="detail-value"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-user"></i> Last Name:</span>
                            <span id="view_last_name" class="detail-value"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-envelope"></i> Email:</span>
                            <span id="view_email_detail" class="detail-value"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-user-tag"></i> Role:</span>
                            <span id="view_role_detail" class="detail-value"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-toggle-on"></i> Account Status:</span>
                            <span id="view_status_detail" class="detail-value"></span>
                        </div>
                        <div class="detail-row" id="view_approved_row" style="display: none;">
                            <span class="detail-label"><i class="fas fa-check-circle"></i> Approval Status:</span>
                            <span id="view_approved_detail" class="detail-value"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-calendar"></i> Joined:</span>
                            <span id="view_date_joined" class="detail-value"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel" onclick="closeViewModal()">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>

    <!-- Delete User Modal (Dark Theme) -->
    <div id="deleteUserModal" class="modal">
        <div class="modal-content delete-modal-content-dark">
            <div class="modal-header delete-modal-header-dark">
                <h3><i class="fas fa-exclamation-triangle"></i> Confirm Deletion</h3>
                <span class="close" onclick="closeDeleteModal()">&times;</span>
            </div>
            <div class="modal-body delete-modal-body-dark">
                <p class="delete-warning-text-dark">
                    Are you sure you want to delete the user <strong id="delete_user_name" style="color: #ef4444;"></strong>?
                </p>
                <div class="delete-warning-box-dark">
                    <i class="fas fa-info-circle"></i>
                    <span>This action cannot be undone and will permanently remove this user from the system.</span>
                </div>
                <form method="POST" id="deleteUserForm">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="delete_single">
                    <input type="hidden" name="user_id" id="delete_user_id">
                    <div class="modal-actions-dark">
                        <button type="button" class="btn-dark btn-cancel-dark" onclick="closeDeleteModal()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="submit" class="btn-dark btn-delete-dark">
                            <i class="fas fa-trash"></i> Yes, Delete User
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Logout Confirmation Modal (Dark Theme) -->
    <div class="modal" id="logoutModal">
        <div class="modal-content delete-modal-content-dark">
            <div class="modal-header delete-modal-header-dark">
                <h3><i class="fas fa-sign-out-alt"></i> Confirm Logout</h3>
                <span class="close" onclick="closeLogoutModal()">&times;</span>
            </div>
            <div class="modal-body delete-modal-body-dark">
                <p class="delete-warning-text-dark">
                    Are you sure you want to log out?
                </p>
                <div class="delete-warning-box-dark">
                    <i class="fas fa-info-circle"></i>
                    <span>You will need to log in again to access your dashboard.</span>
                </div>
                <div class="modal-actions-dark">
                    <button type="button" class="btn-dark btn-cancel-dark" onclick="closeLogoutModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <a href="{% url 'logout' %}" class="btn-dark btn-delete-dark" style="text-decoration: none;">
                        <i class="fas fa-sign-out-alt"></i> Yes, Logout
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="{% static 'scheduler/js/script.js' %}?v=2025"></script>
    
    <script>
        // ============================================
        // HAMBURGER MENU & SIDEBAR TOGGLE
        // ============================================
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');

        if (hamburgerBtn && sidebar && sidebarOverlay) {
            hamburgerBtn.addEventListener('click', function() {
                hamburgerBtn.classList.toggle('active');
                sidebar.classList.toggle('active');
                sidebarOverlay.classList.toggle('active');
                document.body.style.overflow = sidebar.classList.contains('active') ? 'hidden' : 'auto';
            });

            sidebarOverlay.addEventListener('click', function() {
                hamburgerBtn.classList.remove('active');
                sidebar.classList.remove('active');
                sidebarOverlay.classList.remove('active');
                document.body.style.overflow = 'auto';
            });

            document.querySelectorAll('.sidebar-nav a').forEach(link => {
                link.addEventListener('click', function() {
                    if (window.innerWidth <= 767) {
                        hamburgerBtn.classList.remove('active');
                        sidebar.classList.remove('active');
                        sidebarOverlay.classList.remove('active');
                        document.body.style.overflow = 'auto';
                    }
                });
            });

            window.addEventListener('resize', function() {
                if (window.innerWidth > 767) {
                    hamburgerBtn.classList.remove('active');
                    sidebar.classList.remove('active');
                    sidebarOverlay.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
            });
        }

        // ============================================
        // USER DATA FOR MODALS
        // ============================================
        const userData = {
            {% for user in users %}
                '{{ user.id }}': {
                    id: '{{ user.id }}',
                    first_name: '{{ user.first_name }}',
                    last_name: '{{ user.last_name }}',
                    email: '{{ user.email }}',
                    role: '{{ user.role }}',
                    is_active: {{ user.is_active|yesno:"true,false" }},
                    is_approved: {{ user.is_approved|yesno:"true,false" }},
                    date_joined: '{{ user.date_joined|date:"F d, Y" }}'
                },
            {% endfor %}
        };

        // ============================================
        // VIEW MODAL FUNCTIONS
        // ============================================
        function openViewModal(userId) {
            const user = userData[userId];
            if (!user) {
                console.error('User not found:', userId);
                return;
            }

            document.getElementById('view_full_name').textContent = user.first_name + ' ' + user.last_name;
            document.getElementById('view_email').textContent = user.email;
            document.getElementById('view_first_name').textContent = user.first_name;
            document.getElementById('view_last_name').textContent = user.last_name;
            document.getElementById('view_email_detail').textContent = user.email;
            document.getElementById('view_role_detail').textContent = user.role.charAt(0).toUpperCase() + user.role.slice(1).toLowerCase();
            document.getElementById('view_date_joined').textContent = user.date_joined;

            const roleBadge = document.getElementById('view_role_badge');
            roleBadge.textContent = user.role.charAt(0).toUpperCase() + user.role.slice(1).toLowerCase();
            roleBadge.className = 'badge badge-' + user.role.toLowerCase();

            const statusBadge = document.getElementById('view_status_badge');
            if (user.is_active) {
                statusBadge.textContent = 'Active';
                statusBadge.className = 'badge badge-active';
                document.getElementById('view_status_detail').textContent = 'Active';
            } else {
                statusBadge.textContent = 'Inactive';
                statusBadge.className = 'badge badge-inactive';
                document.getElementById('view_status_detail').textContent = 'Inactive';
            }

            if (user.role === 'STUDENT') {
                document.getElementById('view_approved_row').style.display = 'flex';
                const approvedDetail = document.getElementById('view_approved_detail');
                if (user.is_approved) {
                    approvedDetail.textContent = 'Approved';
                    approvedDetail.style.color = '#28a745';
                } else {
                    approvedDetail.textContent = 'Pending Approval';
                    approvedDetail.style.color = '#ffc107';
                }
            } else {
                document.getElementById('view_approved_row').style.display = 'none';
            }

            document.getElementById('viewUserModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeViewModal() {
            document.getElementById('viewUserModal').classList.remove('show');
            document.body.style.overflow = 'auto';
        }

        // ============================================
        // DELETE MODAL FUNCTIONS
        // ============================================
        function openDeleteModal(userId) {
            const user = userData[userId];
            if (!user) {
                console.error('User not found:', userId);
                return;
            }

            document.getElementById('delete_user_name').textContent = user.first_name + ' ' + user.last_name;
            document.getElementById('delete_user_id').value = userId;

            document.getElementById('deleteUserModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeDeleteModal() {
            document.getElementById('deleteUserModal').classList.remove('show');
            document.body.style.overflow = 'auto';
        }

        // ============================================
        // LOGOUT MODAL FUNCTIONS
        // ============================================
        function openLogoutModal() {
            document.getElementById('logoutModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeLogoutModal() {
            document.getElementById('logoutModal').classList.remove('show');
            document.body.style.overflow = 'auto';
        }

        // Close modals when clicking outside
        document.addEventListener('click', function(event) {
            const viewModal = document.getElementById('viewUserModal');
            const deleteModal = document.getElementById('deleteUserModal');
            const logoutModal = document.getElementById('logoutModal');
            
            if (event.target === viewModal) {
                closeViewModal();
            }
            if (event.target === deleteModal) {
                closeDeleteModal();
            }
            if (event.target === logoutModal) {
                closeLogoutModal();
            }
        });

        // Close modals with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeViewModal();
                closeDeleteModal();
                closeLogoutModal();
            }
        });

        // ============================================
        // SELECT ALL & CHECKBOXES
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const userCheckboxes = document.querySelectorAll('.userCheckbox');
            
            if (selectAllCheckbox) {
                selectAllCheckbox.addEventListener('change', function() {
                    const isChecked = this.checked;
                    userCheckboxes.forEach(checkbox => {
                        const row = checkbox.closest('tr');
                        // Only select checkboxes for visible rows
                        if (row.style.display !== 'none') {
                            checkbox.checked = isChecked;
                            if (isChecked) {
                                row.classList.add('selected');
                            } else {
                                row.classList.remove('selected');
                            }
                        }
                    });
                });
            }
            
            userCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        this.closest('tr').classList.add('selected');
                    } else {
                        this.closest('tr').classList.remove('selected');
                    }
                    
                    // Only consider visible checkboxes
                    const visibleCheckboxes = Array.from(userCheckboxes).filter(cb => 
                        cb.closest('tr').style.display !== 'none'
                    );
                    const allChecked = visibleCheckboxes.every(cb => cb.checked);
                    const someChecked = visibleCheckboxes.some(cb => cb.checked);
                    
                    if (selectAllCheckbox) {
                        selectAllCheckbox.checked = allChecked;
                        selectAllCheckbox.indeterminate = someChecked && !allChecked;
                    }
                });
            });
            
            // ============================================
            // TOAST AUTO-DISMISS
            // ============================================
            const toasts = document.querySelectorAll('.toast.auto-hide');
            toasts.forEach(toast => {
                setTimeout(() => {
                    toast.style.animation = 'fadeOut 0.5s ease forwards';
                    setTimeout(() => toast.remove(), 500);
                }, 5000); // Auto-hide after 5 seconds
            });
            
            // ============================================
            // SEARCH FUNCTIONALITY
            // ============================================
            const searchInput = document.getElementById('searchInput');
            const tableRows = document.querySelectorAll('#usersTable tr');
            
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    
                    tableRows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        if (text.includes(searchTerm)) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    });
                });
            }
            
            // ============================================
            // FILTER FUNCTIONALITY
            // ============================================
            const filterBtns = document.querySelectorAll('.filter-btn');
            
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const role = this.getAttribute('data-role');
                    
                    tableRows.forEach(row => {
                        if (role === 'all') {
                            row.style.display = '';
                        } else {
                            const rowRole = row.getAttribute('data-role');
                            if (rowRole === role) {
                                row.style.display = '';
                            } else {
                                row.style.display = 'none';
                            }
                        }
                    });
                });
            });
        });
    </script>

</body>
</html>